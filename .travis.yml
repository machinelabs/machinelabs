sudo: required
dist: trusty
addons:
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable
language: node_js
matrix:
  include:
    - node_js: "7"
      stage: "server"
      before_install:
        # Those ENVs are just needed for the build to compile. Not need for real values.
        - export MACHINELABS_FB_PRIVATE_KEY=KEEP_MY_PRIVACY
        - export MACHINELABS_FB_CLIENT_EMAIL=KEEP_MY_PRIVACY
        - cd ./server
        - npm install -g yarn
      script: npm run ci
    - node_js: "7"
      stage: "firebase functions"
      before_install:
        - cd ./firebase/functions
        - npm install -g yarn
      script: npm run test
    - node_js: "7"
      stage: "@machinelabs/metrics"
      before_install:
        - cd ./shared/metrics
        - npm install -g yarn
      script: npm run ci
    - node_js: "7"
      stage: "@machinelabs/core"
      before_install:
        - cd ./shared/core
        - npm install -g yarn
      script: npm run ci
    - node_js: "6"
      stage: "client"
      before_install:
        - cd ./client
        - export CHROME_BIN=chromium-browser
        - export DISPLAY=:99.0
        - sh -e /etc/init.d/xvfb start
        - npm install -g yarn
      before_script:
        - npm install -g @angular/cli






