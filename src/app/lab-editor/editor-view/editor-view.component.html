<div class="ml-editor-view-layout">
  <div class="ml-editor-view-header">
    <ml-editor-toolbar
      [lab]="lab"
      (action)="toolbarAction($event)"
      ></ml-editor-toolbar>
    <nav md-tab-nav-bar class="ml-editor-view-nav-bar">

      <a routerLink="."
         queryParamsHandling="merge"
         md-tab-link
         (click)="selectTab(TabIndex.Editor)"
         [active]="selectedTab == TabIndex.Editor">Editor</a>

      <a routerLink="."
         queryParamsHandling="merge"
         md-tab-link
         (click)="selectTab(TabIndex.Console)"
         [active]="selectedTab == TabIndex.Console">Console</a>

      <ng-container *ngIf="user | async as user">
        <a *ngIf="userService.userOwnsLab(user, lab)"
           queryParamsHandling="merge"
           routerLink="."
           md-tab-link (click)="selectTab(TabIndex.Settings)"
           [active]="selectedTab == TabIndex.Settings">Settings</a>
      </ng-container>
    </nav>
  </div>
  <div class="ml-editor-view-layout-main">
    <md-sidenav-container>
      <div class="ml-editor-view-layout-columns" [class.hidden]="selectedTab != TabIndex.Editor">
        <ml-panel panelTitle="Files">
          <ml-file-tree
            [files]="lab.directory"
            [selectedFile]="activeFile"
            (selectFile)="openFile($event)"
            (removeFile)="deleteFile($event)"
            (editFile)="openFileNameDialog($event)"
            (addFile)="openFileNameDialog()"></ml-file-tree>
        </ml-panel>
        <div class="ml-editor-view-editor-wrapper">
          <ml-ace-editor
            #editor
            [(value)]="activeFile.content"
            mode="python"
            [class.active]="selectedTab == TabIndex.Editor"></ml-ace-editor>
        </div>
      </div>
      <ml-ace-editor
        #outputPanel
        [value]="output | async"
        [readOnly]="true"
        theme="terminal"
        [class.hidden]="selectedTab != TabIndex.Console"
        [class.active]="selectedTab == TabIndex.Console"
        mode="sh"></ml-ace-editor>
        <ml-lab-settings
          [lab]="lab"
          [class.hidden]="selectedTab != TabIndex.Settings"></ml-lab-settings>
      <md-sidenav
          (open)="sidebarToggled = true"
          (close)="sidebarToggled = false"
          mode="side"
          align="end"
          #executionMetadataSidebar
          class="ml-sidebar"
          >
        <ml-execution-metadata
            *ngFor="let execution of executions | async"
            [execution]="execution"
            (listen)=listen($event)>
        </ml-execution-metadata>
      </md-sidenav>
    </md-sidenav-container>
  </div>
  <ml-footer
    [execution]="execution"
    [slideToggleChecked]="sidebarToggled"
    (slideToggleClick)="executionMetadataSidebar.toggle()"
    ></ml-footer>
</div>
