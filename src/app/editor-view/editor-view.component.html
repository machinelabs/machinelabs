<md-toolbar color="primary">
  <span>MachineLabs</span>
  <span class="ml-toolbar__fill-space"></span>
  <div class="ml-toolbar__cta-bar">
    <button md-button (click)="run(lab)" *ngIf="!context.isRunning()"><md-icon>cached</md-icon> Run</button>
    <button md-button (click)="stop(context)" *ngIf="context.isRunning()"><md-icon>stop</md-icon> Stop</button>
    <button *ngIf="lab.user_id == user?.uid" md-button (click)="save(lab)"><md-icon>save</md-icon> Save</button>
    <button md-button (click)="fork(lab)"><md-icon>share</md-icon> Fork</button>
    <button md-button (click)="create()"><md-icon>add</md-icon> New</button>

    <!-- menu opens when trigger button is clicked -->
    <button md-icon-button [md-menu-trigger-for]="menu">
      <md-icon *ngIf="user?.isAnonymous">more_vert</md-icon>
      <img *ngIf="user && !user.isAnonymous" src="{{user.photoURL}}" alt="{{user.displayName}} profile picture" class="ml-login-avatar">
    </button>

    <md-menu #menu="mdMenu">
        <button md-menu-item *ngIf="user?.isAnonymous" (click)="loginWithGitHub()"><md-icon>perm_identity</md-icon>Login with GitHub</button>
        <button *ngIf="!user?.isAnonymous" (click)="logout()" md-menu-item><md-icon>exit_to_app</md-icon>Sign Out</button>
    </md-menu>
  </div>
</md-toolbar>

<div fxLayout="row">
  <div fxFlex="20" [hidden]="sidebarToggled" class="ml-sidebar">
    <div fxFlex-align="center" class="ml-sidebar__layout">
        <h3 md-subheader>Files</h3>
        <ml-file-tree
          [files]="lab.files"
          (selectFile)="openFile($event)"
          (removeFile)="deleteFile($event)"
          (addFile)="openAddFileDialog()"
          ></ml-file-tree>
    </div>
  </div>
  <div fxFlex>
    <div role="main">
      <div fxLayout="row">
        <ml-panel [panelTitle]="activeFile.name" fxFlex="50">
          <ml-ace-editor
            #editor
            [(value)]="activeFile.content"
            mode="python"
          ></ml-ace-editor>
        </ml-panel>
        <ml-panel panelTitle="Output" fxFlex="50">
          <ml-ace-editor
            [value]="output | async"
            [readOnly]="true"
            [showGutter]="false"
            mode="sh"
          >
          </ml-ace-editor>
        </ml-panel>
      </div>
    </div>
  </div>
</div>
