<ml-editor-layout>
  <ml-editor-layout-header>
    <ml-editor-toolbar
      [lab]="lab"
      (action)="toolbarAction($event)"
      ></ml-editor-toolbar>
    <ml-editor-layout-nav-bar>
      <div md-tab-nav-bar class="ml-editor-view-nav-bar">
        <a routerLink="."
          queryParamsHandling="merge"
          md-tab-link
          (click)="selectTab(TabIndex.Editor)"
          [active]="editorService.editorTabActive()">Editor</a>

        <a routerLink="."
          queryParamsHandling="merge"
          md-tab-link
          (click)="selectTab(TabIndex.Console)"
          [active]="editorService.consoleTabActive()">Console</a>

        <p *ngIf="showRestoreMessage" class="ml-editor-restore-message">You're viewing an older version of this lab. Want to restore latest version? <button md-button color="primary" (click)="restoreLab()">Restore</button></p>
      </div>
    </ml-editor-layout-nav-bar>
  </ml-editor-layout-header>
  <ml-editor-layout-main>
    <md-sidenav-container>
      <ml-editor-layout-panels>
        <ml-editor-layout-panel [class.hidden]="!editorService.editorTabActive()">
          <ml-editor-layout-panel-cta-bar>
          <button md-icon-button mdTooltip="Toogle file tree" mdTooltipPosition="right" (click)="fileTreeSidebar.toggle()"><md-icon>description</md-icon></button>
        </ml-editor-layout-panel-cta-bar>
          <md-sidenav-container>
            <md-sidenav mode="side" #fileTreeSidebar [opened]="true">
              <ml-file-tree></ml-file-tree>
            </md-sidenav>
            <ml-ace-editor
              #editor
              [(value)]="activeFile.content"
              mode="python"
              [class.active]="editorService.editorTabActive()"></ml-ace-editor>
          </md-sidenav-container>
        </ml-editor-layout-panel>
        <ml-editor-layout-panel [class.hidden]="!editorService.consoleTabActive()">
          <ml-ace-editor
            #outputPanel
            [value]="output | async"
            [readOnly]="true"
            theme="terminal"
            [class.hidden]="!editorService.consoleTabActive()"
            [class.active]="editorService.consoleTabActive()"
            mode="sh"></ml-ace-editor>
        </ml-editor-layout-panel>
      </ml-editor-layout-panels>
      <md-sidenav
          (open)="sidebarToggled = true"
          (close)="sidebarToggled = false"
          mode="side"
          align="end"
          #executionMetadataSidebar
          class="ml-sidebar"
          >
        <ng-container *ngIf="executions | async as executions; else noExecutionMessage">
          <ml-execution-list
            [executions]="executions"
            [activeId]="activeExecutionId"
            (restart)="run($event.lab)"
            (view)="listenAndUpdateUrl($event)"
            ></ml-execution-list>
        </ng-container>

        <ng-template #noExecutionMessage>
          <div class="ml-execution-metadata-no-execution-message">
            <md-icon class="ml-execution-metadata-no-execution-message-icon">info_outline</md-icon>
            <h4 class="ml-execution-metadata-no-execution-message-headline">No information available</h4>
            <p class="ml-execution-metadata-no-execution-message-text">Execute your lab and its execution data will show up here.</p>
          </div>
        </ng-template>
      </md-sidenav>
    </md-sidenav-container>
  </ml-editor-layout-main>
  <ml-editor-layout-footer>
    <ml-footer
      [execution]="execution"
      [executionId]="activeExecutionId"
      [lab]="lab"
      [slideToggleChecked]="sidebarToggled"
      (slideToggleClick)="executionMetadataSidebar.toggle()"
      ></ml-footer>
  </ml-editor-layout-footer>
</ml-editor-layout>
